    <!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.11.4">
    <title>DatomicGenServer â€“ datomic_gen_server v2.2.5</title>
    <link rel="stylesheet" href="dist/app-1e374caa3d.css" />
    <script src="dist/sidebar_items.js"></script>
  </head>
  <body data-type="modules">

    <div class="main">
<button class="sidebar-toggle">
  <i class="icon-menu"></i>
</button>
<section class="sidebar">
  <button class="sidebar-toggle">
    <i class="icon-menu"></i>
  </button>

  
  <a href="api-reference.html" class="sidebar-projectLink">
    <div class="sidebar-projectDetails">
      <h1 class="sidebar-projectName">
        datomic_gen_server
      </h1>
      <h2 class="sidebar-projectVersion">
        v2.2.5
      </h2>
    </div>
    
  </a>

  <div class="sidebar-search">
    <i class="icon-search"></i>
    <input type="text" class="sidebar-searchInput" placeholder="search" autocomplete="off" />
  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list" href="#full-list">Pages</a></li>

    
      <li><a id="modules-list" href="#full-list">Modules</a></li>
    

    

    
  </ul>

  <ul id="full-list" class="sidebar-fullList"></ul>
  <div class="sidebar-noResults"></div>
</section>

<section class="content">
  <div id="content" class="content-inner">


      <h1>
        <small class="visible-xs">datomic_gen_server v2.2.5</small>
        DatomicGenServer
        
        
      </h1>

      
        <section id="moduledoc" class="docstring">
          <p>DatomicGenServer is an Elixir GenServer that communicates with a Clojure 
Datomic peer running in the JVM, using clojure-erlastic.</p>
<p>The interface functions in this module communicate with Datomic using edn
strings. To use Elixir data structures, see the accompanying <code class="inline">DatomicGenServer.db</code>
module.</p>
<h2>Examples</h2>
<pre><code class="elixir">DatomicGenServer.start(
  &quot;datomic:mem://test&quot;, 
  true, 
  [{:timeout, 20_000}, {:default_message_timeout, 20_000}, {:name, DatomicGenServer}]
)

query = &quot;[:find ?c :where [?c :db/doc \&quot;Some docstring that isn&#39;t in the database\&quot;]]&quot;
DatomicGenServer.q(DatomicGenServer, query)

# =&gt; {:ok, &quot;#{}\n&quot;}

data_to_add = &quot;&quot;&quot;
  [ { :db/id #db/id[:db.part/db]
      :db/ident :person/name
      :db/valueType :db.type/string
      :db/cardinality :db.cardinality/one
      :db/doc \&quot;A person&#39;s name\&quot;
      :db.install/_attribute :db.part/db}]
&quot;&quot;&quot;

DatomicGenServer.transact(DatomicGenServer, data_to_add)

# =&gt; {:ok, &quot;{:db-before {:basis-t 1000}, :db-after {:basis-t 1000}, 
              :tx-data [{:a 50, :e 13194139534313, :v #inst \&quot;2016-02-14T02:10:54.580-00:00\&quot;, 
              :tx 13194139534313, :added true} {:a 10, :e 64, :v :person/name, :tx 13194139534313, 
              :added true} {:a 40, :e 64, :v 23, :tx 13194139534313, :added true} {:a 41, 
              :e 64, :v 35, :tx 13194139534313, :added true} {:a 62, :e 64, 
              :v \&quot;A person&#39;s name\&quot;, :tx 13194139534313, :added true} {:a 13, 
              :e 0, :v 64, :tx 13194139534313, :added true}], :tempids {-9223367638809264705 64}}&quot;}</code></pre>

        </section>
      

      
        <section id="summary" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#summary">
              <i class="icon-link"></i>
            </a>
            Summary
          </h1>
          
  <div class="summary-types summary">
    <h2>
      <a href="#types">Types</a>
    </h2>
    <div class="summary-row">
  <div class="summary-signature">
    <a href="#t:datomic_call/0">datomic_call()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:datomic_message/0">datomic_message()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:datomic_result/0">datomic_result()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:send_option/0">send_option()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:start_option/0">start_option()</a>
  </div>
  
</div>

  </div>


          
  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>
    <div class="summary-row">
  <div class="summary-signature">
    <a href="#entity/4">entity(server_identifier, edn_str, attr_names \\ :all, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Issues an <code class="inline">entity</code> call that is passed to the Datomic <code class="inline">entity</code> API function</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#load/3">load(server_identifier, data_path, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Issues a call to the Clojure net.phobot.datomic/seed library to load data into 
a database using data files in edn format. The database is not dropped, 
recreated, or migrated before loading</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#migrate/3">migrate(server_identifier, migration_path, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Issues a call to net.phobot.datomic/migrator to migrate a database using
database migration files in edn format</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#mock/3">mock(server_identifier, db_key, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Saves a snapshot of the current database state using a supplied key, and 
creates a mock connection (using the datomock library) using that database
as a starting point.  Requires the <code class="inline">:allow_datomic_mocking?</code> configuration
parameter to be set in the <code class="inline">:datomic_gen_server</code> application environment;
otherwise the current connection and database continue to be active. 
Subsequent operations on the database will use the mock connection until
you call either the <code class="inline">reset</code> or <code class="inline">unmock</code> functions</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#pull/4">pull(server_identifier, pattern_str, identifier_str, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Issues a <code class="inline">pull</code> call that is passed to the Datomic <code class="inline">pull</code> API function</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#pull_many/4">pull_many(server_identifier, pattern_str, identifiers_str, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Issues a <code class="inline">pull-many</code> call that is passed to the Datomic <code class="inline">pull-many</code> API function</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#q/4">q(server_identifier, edn_str, bindings_edn \\ [], options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Queries a DatomicGenServer using a query formulated as an edn string.
This query is passed to the Datomic <code class="inline">q</code> API function</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#reset/3">reset(server_identifier, db_key, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Generates a new mock connection using a database snapshot previously saved
using the <code class="inline">mock</code> function. Requires the <code class="inline">:allow_datomic_mocking?</code> configuration
parameter to be set in the <code class="inline">:datomic_gen_server</code> application enviroment;
otherwise the current connection and database continue to be active</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#start/3">start(db_uri, create? \\ false, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Starts the GenServer</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#start_link/3">start_link(db_uri, create? \\ false, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Starts the GenServer in a linked process</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#transact/3">transact(server_identifier, edn_str, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Issues a transaction against a DatomicGenServer using a transaction 
formulated as an edn string. This transaction is passed to the Datomic <code class="inline">transact</code> 
API function</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#unmock/2">unmock(server_identifier, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Reverts to using a database derived from the real database connection rather
than a mocked connection. If no mock connection is active, this function is
a no-op</p>
</div>
  
</div>

  </div>


          

          

        </section>
      

      
        <section id="types" class="types details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#types">
              <i class="icon-link"></i>
            </a>
            Types
          </h1>
          <div class="types-list">
            <div id="t:datomic_call/0" class="type-detail">
  <pre><code class="elixir"><a href="#t:datomic_call/0">datomic_call</a> :: {<a href="#t:datomic_message/0">datomic_message</a>, message_timeout :: non_neg_integer}</code></pre>
  
</div>
<div id="t:datomic_message/0" class="type-detail">
  <pre><code class="elixir"><a href="#t:datomic_message/0">datomic_message</a> ::
  {:q, integer, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, [<a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>]} |
  {:transact, integer, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>} |
  {:pull, integer, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>} |
  {:"pull-many", integer, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>} |
  {:entity, integer, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, [atom] | :all} |
  {:migrate, integer, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>} |
  {:load, integer, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>} |
  {:mock, integer, atom} |
  {:reset, integer, atom} |
  {:unmock, integer}</code></pre>
  
</div>
<div id="t:datomic_result/0" class="type-detail">
  <pre><code class="elixir"><a href="#t:datomic_result/0">datomic_result</a> :: {:ok, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>} | {:error, term}</code></pre>
  
</div>
<div id="t:send_option/0" class="type-detail">
  <pre><code class="elixir"><a href="#t:send_option/0">send_option</a> ::
  {:message_timeout, non_neg_integer} |
  {:client_timeout, non_neg_integer}</code></pre>
  
</div>
<div id="t:start_option/0" class="type-detail">
  <pre><code class="elixir"><a href="#t:start_option/0">start_option</a> ::
  <a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:option/0">GenServer.option</a> |
  {:default_message_timeout, non_neg_integer}</code></pre>
  
</div>

          </div>
        </section>
      

      
        <section id="functions" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#functions">
              <i class="icon-link"></i>
            </a>
            Functions
          </h1>
          <div class="detail" id="entity/4">
  <div class="detail-header">
    <a href="#entity/4" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">entity(server_identifier, edn_str, attr_names \\ :all, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">entity(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, [atom] | :all, [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Issues an <code class="inline">entity</code> call that is passed to the Datomic <code class="inline">entity</code> API function. </p>
<p>The first parameter to this function is the pid or alias of the GenServer process; 
the second is an edn string representing the parameter that is to be passed to 
<code class="inline">entity</code>: either an entity id, an ident, or a lookup ref. The third parameter 
is a list of atoms that represent the keys of the attributes you wish to fetch, 
or <code class="inline">:all</code> if you want all the entityâ€™s attributes. </p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">DatomicGenServer.entity(DatomicGenServer, &quot;:person/email&quot;, [:&quot;db/valueType&quot;, :&quot;db/doc&quot;])

=&gt; {:ok, &quot;{:db/valueType :db.type/string, :db/doc \&quot;A person&#39;s email\&quot;}\n&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="load/3">
  <div class="detail-header">
    <a href="#load/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">load(server_identifier, data_path, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">load(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Issues a call to the Clojure net.phobot.datomic/seed library to load data into 
a database using data files in edn format. The database is not dropped, 
recreated, or migrated before loading.</p>
<p>The first parameter to this function is the pid or alias of the GenServer process; 
the second is the path to the directory containing the data files. The data 
files will be processed in the sort order of their directory. </p>
<p>Data is loaded in a single transaction. The return value of the function 
is the result of the Datomic <code class="inline">transact</code> API function call that executed the
transaction. If you want this result in a struct, call the wrapper <code class="inline">load</code> 
function in the <a href="DatomicGenServer.Db.html"><code class="inline">DatomicGenServer.Db</code></a> module.</p>
<p>Loading data does not use the Clojure Conformity library and is not idempotent.</p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">data_dir = Path.join [System.cwd(), &quot;seed-data&quot;]
DatomicGenServer.load(DatomicGenServer, data_dir)

=&gt; {:ok, &quot;{:db-before {:basis-t 1000}, :db-after {:basis-t 1000}, ...</code></pre>

  </section>
</div>
<div class="detail" id="migrate/3">
  <div class="detail-header">
    <a href="#migrate/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">migrate(server_identifier, migration_path, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">migrate(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Issues a call to net.phobot.datomic/migrator to migrate a database using
database migration files in edn format.</p>
<p>The first parameter to this function is the pid or alias of the GenServer process; 
the second is the path to the directory containing the migration files. Files
will be processed in sort order. The Clojure Conformity library is used to keep
the migrations idempotent. </p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">DatomicGenServer.migrate(DatomicGenServer, Path.join [System.cwd(), &quot;migrations&quot;])

=&gt; {:ok, :migrated}</code></pre>

  </section>
</div>
<div class="detail" id="mock/3">
  <div class="detail-header">
    <a href="#mock/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">mock(server_identifier, db_key, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">mock(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, atom, [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Saves a snapshot of the current database state using a supplied key, and 
creates a mock connection (using the datomock library) using that database
as a starting point.  Requires the <code class="inline">:allow_datomic_mocking?</code> configuration
parameter to be set in the <code class="inline">:datomic_gen_server</code> application environment;
otherwise the current connection and database continue to be active. 
Subsequent operations on the database will use the mock connection until
you call either the <code class="inline">reset</code> or <code class="inline">unmock</code> functions.</p>
<p>The first parameter to this function is the pid or alias of the GenServer process; 
the second is the key under which to store the database snapshot. If successful,
the return value is a tuple of <code class="inline">:ok</code> and the key that was passed to the function.</p>
<p>The active database can be reverted to the initial snapshot using the <code class="inline">reset</code> 
function, or can be switched back to use the real, live connection and database
using the <code class="inline">unmock</code> function.</p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">DatomicGenServer.mock(DatomicGenServer, :&quot;just-migrated&quot;)

=&gt; {:ok, :&quot;just-migrated&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="pull/4">
  <div class="detail-header">
    <a href="#pull/4" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">pull(server_identifier, pattern_str, identifier_str, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">pull(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Issues a <code class="inline">pull</code> call that is passed to the Datomic <code class="inline">pull</code> API function. </p>
<p>The first parameter to this function is the pid or alias of the GenServer process; 
the second is an edn string representing the pattern that is to be passed as the
first parameter to <code class="inline">pull</code> â€” you shouldnâ€™t need to single-quote this. The third 
parameter is an entity identifier (entity id, ident, or lookup ref).</p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">DatomicGenServer.pull(DatomicGenServer, &quot;[*]&quot;, &quot;123242&quot;)

=&gt; {:ok, &quot;{:db/id 75, :db/ident :person/city, :db/valueType {:db/id 23}, 
           :db/cardinality {:db/id 35}, :db/doc &quot;A person&#39;s city&quot;}</code></pre>
<p>â€œ}</p>

  </section>
</div>
<div class="detail" id="pull_many/4">
  <div class="detail-header">
    <a href="#pull_many/4" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">pull_many(server_identifier, pattern_str, identifiers_str, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">pull_many(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Issues a <code class="inline">pull-many</code> call that is passed to the Datomic <code class="inline">pull-many</code> API function. </p>
<p>The first parameter to this function is the pid or alias of the GenServer process; 
the second is an edn string representing the pattern that is to be passed as the
first parameter to <code class="inline">pull-many</code> â€” you shouldnâ€™t need to single-quote this. The  
third parameter is a  list of entity identifiers (entity id, ident, or lookup ref).</p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">DatomicGenServer.pull_many(DatomicGenServer, &quot;[*]&quot;, &quot;[12343 :person/zip]&quot;)

=&gt; {:ok, &quot;[{:db/id 67, :db/ident :person/state, :db/valueType {:db/id 23}, 
              :db/cardinality {:db/id 35}, :db/doc &quot;A person&#39;s state&quot;} 
           {:db/id 78, :db/ident :person/zip, :db/valueType {:db/id 23}, 
              :db/cardinality {:db/id 35}, :db/doc &quot;A person&#39;s zip code&quot;}]</code></pre>
<p>â€œ}</p>

  </section>
</div>
<div class="detail" id="q/4">
  <div class="detail-header">
    <a href="#q/4" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">q(server_identifier, edn_str, bindings_edn \\ [], options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">q(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, [<a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>], [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Queries a DatomicGenServer using a query formulated as an edn string.
This query is passed to the Datomic <code class="inline">q</code> API function.</p>
<p>The first parameter to this function is the pid or alias of the GenServer process;
the second is the query.</p>
<p>The optional third parameter is a list of bindings for the data sources in the 
query, passed to the <code class="inline">inputs</code> argument of the Datomic <code class="inline">q</code> function. <strong>IMPORTANT:</strong> 
These bindings are passed in the form of edn strings which are read back in the  
Clojure peer and then passed to Clojure <code class="inline">eval</code>. Since any arbitrary Clojure forms  
that are passed in are evaluated, <strong>you must be particularly careful that these  
bindings are sanitized</strong> and that you are not passing anything that you donâ€™t
control. In general, you should prefer the <code class="inline">DatomicGenServer.Db.q/3</code> function
which accepts data structures and converts them to edn.</p>
<p>Bindings may include <code class="inline">datomic_gen_server.peer/*db*</code> for the current database.  </p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">query = &quot;[:find ?c :where [?c :db/doc \&quot;Some docstring that isn&#39;t in the database\&quot;]]&quot;
DatomicGenServer.q(DatomicGenServer, query)

=&gt; {:ok, &quot;#{}\n&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="reset/3">
  <div class="detail-header">
    <a href="#reset/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">reset(server_identifier, db_key, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">reset(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, atom, [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Generates a new mock connection using a database snapshot previously saved
using the <code class="inline">mock</code> function. Requires the <code class="inline">:allow_datomic_mocking?</code> configuration
parameter to be set in the <code class="inline">:datomic_gen_server</code> application enviroment;
otherwise the current connection and database continue to be active.</p>
<p>The first parameter to this function is the pid or alias of the GenServer process; 
the second is the key under which the database snapshot was saved. If successful,
the return value is a tuple of <code class="inline">:ok</code> and the key that was passed to the function.</p>
<p>The database can be switched back to a real connection using the <code class="inline">unmock</code> 
function. It is also possible to manipulate the mocked database and save that
new database state in a snapshot using the <code class="inline">mock</code> function.</p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">DatomicGenServer.reset(DatomicGenServer, :&quot;just-migrated&quot;)

=&gt; {:ok, :&quot;just-migrated&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="start/3">
  <div class="detail-header">
    <a href="#start/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">start(db_uri, create? \\ false, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">start(<a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, boolean, [<a href="#t:start_option/0">start_option</a>]) :: <a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:on_start/0">GenServer.on_start</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Starts the GenServer. </p>
<p>This function is basically a pass-through to <code class="inline">GenServer.start</code>, but with some 
additional parameters: The first is the URL of the Datomic transactor to which 
to connect, and the second a boolean parameter indicating whether or not to 
create the database if it does not yet exist. </p>
<p>The options keyword list may include the normal options accepted by <code class="inline">GenServer.start</code>, 
as well as a <code class="inline">:default_message_timeout</code> option that controls the default time in 
milliseconds that the server will wait for a database response before crashing. 
Note that if the <code class="inline">:timeout</code> option is provided, the GenServer will crash if that 
timeout is exceeded.</p>
<h2>Example</h2>
<pre><code class="elixir">DatomicGenServer.start(
  &quot;datomic:mem://test&quot;, 
  true, 
  [{:timeout, 20_000}, {:default_message_timeout, 20_000}, {:name, DatomicGenServer}]
)</code></pre>

  </section>
</div>
<div class="detail" id="start_link/3">
  <div class="detail-header">
    <a href="#start_link/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">start_link(db_uri, create? \\ false, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">start_link(<a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, boolean, [<a href="#t:start_option/0">start_option</a>]) :: <a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:on_start/0">GenServer.on_start</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Starts the GenServer in a linked process. </p>
<p>This function is basically a pass-through to <code class="inline">GenServer.start_link</code>, but with 
some additional parameters: The first is the URL of the Datomic transactor to 
which to connect, and the second a boolean parameter indicating whether or not 
to create the database if it does not yet exist. </p>
<p>The options keyword list may include the normal options accepted by <code class="inline">GenServer.start_link</code>, 
as well as a <code class="inline">:default_message_timeout</code> option that controls the default time in 
milliseconds that the server will wait for a database response before crashing. 
Note that if the <code class="inline">:timeout</code> option is provided, the GenServer will crash if that 
timeout is exceeded.</p>
<h2>Example</h2>
<pre><code class="elixir">DatomicGenServer.start_link(
  &quot;datomic:mem://test&quot;, 
  true, 
  [{:timeout, 20_000}, {:default_message_timeout, 20_000}, {:name, DatomicGenServer}]
)</code></pre>

  </section>
</div>
<div class="detail" id="transact/3">
  <div class="detail-header">
    <a href="#transact/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">transact(server_identifier, edn_str, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">transact(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, <a href="http://elixir-lang.org/docs/stable/elixir/String.html#t:t/0">String.t</a>, [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Issues a transaction against a DatomicGenServer using a transaction 
formulated as an edn string. This transaction is passed to the Datomic <code class="inline">transact</code> 
API function. </p>
<p>The first parameter to this function is the pid or alias of the GenServer process; 
the second is the transaction data in edn format. </p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">data_to_add = &quot;&quot;&quot;
  [ { :db/id #db/id[:db.part/db]
      :db/ident :person/name
      :db/valueType :db.type/string
      :db/cardinality :db.cardinality/one
      :db/doc \&quot;A person&#39;s name\&quot;
      :db.install/_attribute :db.part/db}]
&quot;&quot;&quot;

DatomicGenServer.transact(DatomicGenServer, data_to_add)

=&gt; {:ok, &quot;{:db-before {:basis-t 1000}, :db-after {:basis-t 1000}, 
          :tx-data [{:a 50, :e 13194139534313, :v #inst \&quot;2016-02-14T02:10:54.580-00:00\&quot;, 
          :tx 13194139534313, :added true} {:a 10, :e 64, :v :person/name, :tx 13194139534313, 
          :added true} {:a 40, :e 64, :v 23, :tx 13194139534313, :added true} {:a 41, 
          :e 64, :v 35, :tx 13194139534313, :added true} {:a 62, :e 64, 
          :v \&quot;A person&#39;s name\&quot;, :tx 13194139534313, :added true} {:a 13, 
          :e 0, :v 64, :tx 13194139534313, :added true}], :tempids {-9223367638809264705 64}}&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="unmock/2">
  <div class="detail-header">
    <a href="#unmock/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">unmock(server_identifier, options \\ [])</span>
      
  </div>
  
    <div class="specs">
      <h4 class="specs-title">Specs</h4>
      <div class="specs-list">
        
          <pre><code class="elixir">unmock(<a href="http://elixir-lang.org/docs/stable/elixir/GenServer.html#t:server/0">GenServer.server</a>, [<a href="#t:send_option/0">send_option</a>]) :: <a href="#t:datomic_result/0">datomic_result</a></code></pre>
        
      </div>
    </div>
  
  <section class="docstring">
    <p>Reverts to using a database derived from the real database connection rather
than a mocked connection. If no mock connection is active, this function is
a no-op.</p>
<p>If the call is successful, the return value is a tuple of <code class="inline">:ok</code> and <code class="inline">:unmocked</code>.</p>
<p>The first parameter to this function is the pid or alias of the GenServer process. </p>
<p>The options keyword list may also include a <code class="inline">:client_timeout</code> option that  
specifies the milliseconds timeout passed to <code class="inline">GenServer.call</code>, and a  
<code class="inline">:message_timeout</code> option that specifies how long the GenServer should wait 
for a response before crashing (overriding the default value set in 
<code class="inline">DatomicGenServer.start</code> or <code class="inline">DatomicGenServer.start_link</code>). Note that if the 
<code class="inline">:client_timeout</code> is shorter than the <code class="inline">:message_timeout</code> value, the call will 
return an error but the server will not crash even if the response message is 
never returned from the Clojure peer. </p>
<p>If the client timeout is not supplied, the value is taken from the configured 
value of <code class="inline">:timeout_on_call</code> in the application environment; if that is not 
configured, the GenServer default of 5000 is used.</p>
<p>If the message timeout is not supplied, the default value supplied at startup 
with the option <code class="inline">:default_message_timeout</code> is used; if this was not specified, 
the configured value of <code class="inline">:message_wait_until_crash</code> in the application 
environment is used. If this is also omitted, a value of 5000 is used.</p>
<h2>Example</h2>
<pre><code class="elixir">DatomicGenServer.unmock(DatomicGenServer)

=&gt; {:ok, :unmocked}</code></pre>

  </section>
</div>

        </section>
      

      

      
        <footer class="footer">
      <p>
        <span class="line">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" rel="help" target="_blank">ExDoc</a> (v0.11.4),
        </span>
        <span class="line">
          designed by
          <a href="https://twitter.com/dignifiedquire" target="_blank" title="@dignifiedquire">Friedel Ziegelmayer</a>.
          </span>
      </p>
      <button class="night-mode-toggle" />
    </footer>
  </div>
</section>
</div>
  <script src="dist/app-6d2e071366.js"></script>
  </body>
</html>

